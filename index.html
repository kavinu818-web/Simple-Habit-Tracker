<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Habit Tracker ‚Äî Multi‚ÄëUser (K/A) ‚Äî GitHub Pages Ready</title>
  <style>
    :root{
      --bg:#0b0d12; --panel:#121826; --muted:#8a93a5; --text:#e6e7eb; --border:#1f2a3c;
      --accent:#6d5dfc; --ok:#22c55e; --warn:#f59e0b; --danger:#ef4444; --panel2:#0e1320;
    }
    *{box-sizing:border-box}
    body{margin:0;background:radial-gradient(1200px 600px at 0% 0%, #0e1530, transparent),var(--bg);color:var(--text);font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial}
    .app{display:grid;grid-template-columns:240px 1fr;min-height:100vh}
    .sidebar{background:linear-gradient(180deg, rgba(255,255,255,.02), transparent 60%), var(--panel);border-right:1px solid var(--border);padding:16px;position:sticky;top:0;height:100vh}
    .brand{display:flex;align-items:center;gap:10px;margin-bottom:14px}
    .avatar{width:40px;height:40px;border-radius:12px;background:#1a2238;display:grid;place-items:center;font-weight:700}
    .nav a{display:flex;align-items:center;gap:10px;padding:10px;border-radius:10px;color:inherit;text-decoration:none;border:1px solid transparent}
    .nav a.active, .nav a:hover{background:#0f1422;border-color:#1f2a3c}
    .content{padding:16px}
    .heading{font-size:22px;margin:0 0 8px}
    .muted{color:var(--muted)}
    .cards{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin:12px 0}
    .card{background:var(--panel2);border:1px solid var(--border);border-radius:14px;padding:12px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
    .card h3{margin:0 0 6px;font-size:14px;color:var(--muted)}
    .val{font-size:22px;font-weight:800}
    .grid{display:grid;grid-template-columns:2fr 1fr;gap:12px}
    .full{grid-column:1/-1}
    input, select, button{background:#0d1222;color:var(--text);border:1px solid var(--border);border-radius:10px;padding:9px 10px}
    button{cursor:pointer}
    button.primary{background:var(--accent);border-color:#5b4df0}
    button.ghost{background:transparent}
    button.danger{border-color:#3a2631;color:#ff9db4}
    table{width:100%;border-collapse:collapse}
    th,td{border-bottom:1px solid var(--border);padding:8px;text-align:left}
    td:last-child{text-align:right}
    .chips{display:flex;flex-wrap:wrap;gap:6px}
    .chip{background:#0e1322;border:1px solid var(--border);padding:6px 10px;border-radius:999px;display:flex;gap:6px;align-items:center}
    .chip .x{cursor:pointer;opacity:.8}
    .charts{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .heatmap{display:grid;grid-template-columns:repeat(53, 12px);gap:3px;align-items:center}
    .heatmap .cell{width:12px;height:12px;border-radius:2px;background:#0a0f1e;border:1px solid #0f1830}
    .legend{display:flex;gap:6px;align-items:center}
    .legend .swatch{width:12px;height:12px;border-radius:2px;border:1px solid #0f1830}
    .s0{background:#0a0f1e} .s1{background:#1b2a4b} .s2{background:#2a4d7c} .s3{background:#3b71b0} .s4{background:#5ba0ff}
    .section{display:none}
    .section.show{display:block}
    .topbar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .logout{margin-top:auto}
    @media (max-width:980px){.app{grid-template-columns:1fr}.sidebar{position:static;height:auto}.cards{grid-template-columns:1fr 1fr}.grid{grid-template-columns:1fr}.charts{grid-template-columns:1fr}}

  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div id="login" class="login" aria-modal="true">
  <div class="box">
    <h2 style="margin:0">Choose User</h2>
    <p class="muted" style="margin:6px 0 10px">Login to your dashboard. (K ‚Üí <code>K1234</code>, A ‚Üí <code>A1234</code>)</p>
    <div class="users">
      <button class="userbtn" data-user="K"><div class="circle">K</div><div>Sign in as K</div></button>
      <button class="userbtn" data-user="A"><div class="circle">A</div><div>Sign in as A</div></button>
    </div>
    <div class="row" style="margin-top:8px">
      <input id="pw" type="password" placeholder="Enter password" style="flex:1" />
      <button id="loginBtn" class="primary">Login</button>
    </div>
    <div id="err" class="err"></div>
  </div>
</div>

<div class="app" id="app" style="display:none">
  <aside class="sidebar">
    <div class="brand">
      <div class="avatar" id="avatar">U</div>
      <div>
        <div id="uname" style="font-weight:700">User</div>
        <div class="muted" style="font-size:12px">alex@example.com</div>
      </div>
    </div>
    <nav class="nav" id="nav">
      <a href="#dashboard" data-sec="dashboard" class="active">üìä Dashboard</a>
      <a href="#timer" data-sec="timer">‚è±Ô∏è Study Timer</a>
      <a href="#habits" data-sec="habits">üóÇÔ∏è Habits</a>
      <a href="#calendar" data-sec="calendar">üìÖ Calendar</a>
      <a href="#leader" data-sec="leader">üèÜ Leaderboard</a>
      <a href="#friends" data-sec="friends">üë• Friends</a>
    </nav>
    <button id="logout" class="ghost logout">Log out</button>
  </aside>

  <main class="content">
    <div class="topbar">
      <h2 class="heading" id="pagetitle">Dashboard</h2>
      <div class="muted">Multi‚Äëuser ¬∑ LocalStorage</div>
    </div>

    <!-- DASHBOARD -->
    <section id="sec-dashboard" class="section show">
      <div class="cards">
        <div class="card"><h3>Today's Study</h3><div class="val" id="d-today">0m</div><div class="muted" id="d-today-delta"></div></div>
        <div class="card"><h3>This Week</h3><div class="val" id="d-week">0h 0m</div></div>
        <div class="card"><h3>This Year</h3><div class="val" id="d-year">0h 0m</div></div>
        <div class="card"><h3>Lifetime</h3><div class="val" id="d-life">0h 0m</div></div>
      </div>
      <div class="charts">
        <div class="card"><h3>Time by Habit (14 days)</h3><canvas id="c-byhabit"></canvas></div>
        <div class="card"><h3>Daily Trend (14 days)</h3><canvas id="c-daily"></canvas></div>
        <div class="card"><h3>Weekly Trend (12 weeks)</h3><canvas id="c-weekly"></canvas></div>
        <div class="card"><h3>Monthly Trend (12 months)</h3><canvas id="c-monthly"></canvas></div>
      </div>
      <div class="card full" style="margin-top:12px">
        <h3>Study Heatmap (365 days)</h3>
        <div id="heatmap" class="heatmap"></div>
        <div class="legend muted" style="margin-top:6px">
          <span>Less</span>
          <span class="swatch s0"></span><span class="swatch s1"></span><span class="swatch s2"></span><span class="swatch s3"></span><span class="swatch s4"></span>
          <span>More</span>
        </div>
      </div>
    </section>

    <!-- TIMER -->
    <section id="sec-timer" class="section">
      <div class="grid">
        <div class="card">
          <h3>Study Timer</h3>
          <div class="row" style="margin:6px 0 10px">
            <label class="muted">Habit</label>
            <select id="habitSelect"></select>
            <input id="newHabit" placeholder="New habit‚Ä¶" />
            <button id="addHabitBtn">Add</button>
          </div>
          <div class="row" style="justify-content:space-between">
            <div id="timerDisplay" style="font-variant-numeric:tabular-nums;font-size:34px;font-weight:800">00:00:00</div>
            <div class="row">
              <button id="startBtn" class="primary">Start</button>
              <button id="stopBtn" disabled>Stop</button>
              <button id="resetBtn" disabled>Reset</button>
            </div>
          </div>
          <div class="row"><label><input type="checkbox" id="autoSave" checked /> Auto‚Äësave on Stop</label></div>
          <h3 style="margin:12px 0 6px">Recent Sessions</h3>
          <table>
            <thead><tr><th>Habit</th><th>Start</th><th>End</th><th>Duration</th><th></th></tr></thead>
            <tbody id="sessionRows"></tbody>
          </table>
        </div>
        <div class="card">
          <h3>Quick Stats</h3>
          <div>Today: <strong id="t-today">0m</strong></div>
          <div>This Week: <strong id="t-week">0h 0m</strong></div>
          <div>This Year: <strong id="t-year">0h 0m</strong></div>
          <div>Lifetime: <strong id="t-life">0h 0m</strong></div>
        </div>
      </div>
    </section>

    <!-- HABITS -->
    <section id="sec-habits" class="section">
      <div class="card">
        <h3>Your Habits</h3>
        <div id="habitChips" class="chips" style="margin:8px 0"></div>
        <div class="row"><input id="habitInput" placeholder="Add a habit‚Ä¶" /><button id="habitAdd">Add</button></div>
      </div>
    </section>

    <!-- LEADERBOARD -->
    <section id="sec-leader" class="section">
      <div class="card full">
        <h3>Leaderboard (All Users)</h3>
        <table>
          <thead><tr><th>#</th><th>Name</th><th>Total Minutes</th></tr></thead>
          <tbody id="leaderRows"></tbody>
        </table>
      </div>
    </section>

    <!-- PLACEHOLDERS -->
    <section id="sec-calendar" class="section"><div class="card">Calendar is coming soon.</div></section>
    <section id="sec-friends" class="section"><div class="card">Friends is coming soon.</div></section>
  </main>
</div>

<script>
// ====== Data & Storage ======
const KEY = 'habits-multi:data';
function defaultData(){
  return { currentUser:null, users:{ K:{ habits:['Study'], sessions:[] }, A:{ habits:['Study'], sessions:[] } } };
}
function load(){ try{ const raw=localStorage.getItem(KEY); return raw? JSON.parse(raw): defaultData(); } catch{ return defaultData(); } }
function save(){ localStorage.setItem(KEY, JSON.stringify(data)); }
let data = load();

// ====== Login ======
const loginEl = document.getElementById('login');
const pwEl = document.getElementById('pw');
const errEl = document.getElementById('err');
let pendingUser = 'K';
Array.from(document.querySelectorAll('.userbtn')).forEach(btn=>btn.onclick=()=>{ pendingUser = btn.dataset.user; errEl.textContent=''; });

document.getElementById('loginBtn').onclick = ()=>{
  const p = pwEl.value.trim();
  if((pendingUser==='K' && p==='K1234') || (pendingUser==='A' && p==='A1234')){
    data.currentUser = pendingUser; save(); startApp();
  } else { errEl.textContent = 'Incorrect password'; }
};

function startApp(){
  loginEl.style.display='none';
  document.getElementById('app').style.display='grid';
  initUI();
}

if(data.currentUser){ loginEl.style.display='none'; document.getElementById('app').style.display='grid'; initUI(); }

// ====== UI Common ======
const unameEl = document.getElementById('uname');
const avatarEl = document.getElementById('avatar');
const logoutBtn = document.getElementById('logout');
logoutBtn.onclick=()=>{ data.currentUser=null; save(); location.reload(); };

function current(){ return data.users[data.currentUser]; }
function ensureOtherUser(u){ return data.users[u]; }

function initUI(){
  unameEl.textContent = data.currentUser === 'K' ? 'K' : 'A';
  avatarEl.textContent = data.currentUser;
  refreshHabits();
  renderSessions();
  refreshKPIs();
  rebuildCharts();
  buildHeatmap();
  buildLeaderboard();
}

// ====== Navigation ======
const nav = document.getElementById('nav');
const secs = {
  dashboard: document.getElementById('sec-dashboard'),
  timer: document.getElementById('sec-timer'),
  habits: document.getElementById('sec-habits'),
  calendar: document.getElementById('sec-calendar'),
  leader: document.getElementById('sec-leader'),
  friends: document.getElementById('sec-friends'),
};
nav.querySelectorAll('a').forEach(a=>a.addEventListener('click', (e)=>{
  nav.querySelectorAll('a').forEach(x=>x.classList.remove('active'));
  a.classList.add('active');
  const key = a.dataset.sec; document.getElementById('pagetitle').textContent = a.textContent.replace(/^[^a-zA-Z]+/,'');
  Object.values(secs).forEach(s=>s.classList.remove('show')); secs[key].classList.add('show');
  e.preventDefault();
}));

// ====== Utilities ======
const pad=n=>String(n).padStart(2,'0');
function fmtMs(ms){ const s=Math.floor(ms/1000); const h=Math.floor(s/3600), m=Math.floor((s%3600)/60), sec=s%60; return `${pad(h)}:${pad(m)}:${pad(sec)}` }
function fmtMin(min){ const h=Math.floor(min/60), m=min%60; return `${h}h ${m}m`; }
function minutesBetween(a,b){ return Math.max(1, Math.round((new Date(b)-new Date(a))/60000)); }
function dateKey(d){ return new Date(d).toISOString().slice(0,10); }
function sumMins(user, filterFn){ return user.sessions.filter(filterFn).reduce((a,b)=>a+b.minutes,0); }

// ====== Habits ======
const habitSelect = document.getElementById('habitSelect');
const habitChips = document.getElementById('habitChips');
const newHabit = document.getElementById('newHabit');
const addHabitBtn = document.getElementById('addHabitBtn');
const habitInput = document.getElementById('habitInput');
const habitAdd = document.getElementById('habitAdd');

function refreshHabits(){
  const u=current();
  habitSelect.innerHTML = u.habits.map(h=>`<option>${h}</option>`).join('');
  habitChips.innerHTML = u.habits.map(h=>`<div class="chip"><span>${h}</span><span class="x" data-x="${h}">‚úï</span></div>`).join('');
  habitChips.querySelectorAll('[data-x]').forEach(x=>x.onclick=()=>removeHabit(x.dataset.x));
}
function addHabit(v){ const u=current(); const name=(v||'').trim(); if(!name || u.habits.includes(name)) return; u.habits.push(name); save(); refreshHabits(); rebuildCharts(); buildHeatmap(); }
function removeHabit(h){ const u=current(); const used = u.sessions.some(s=>s.habit===h); if(used && !confirm(`Delete habit "${h}" and keep sessions (relabeled to 'Other')?`)) return; if(used){ u.sessions.forEach(s=>{ if(s.habit===h) s.habit='Other'; }); if(!u.habits.includes('Other')) u.habits.push('Other'); }
  u.habits = u.habits.filter(x=>x!==h); save(); refreshHabits(); rebuildCharts(); buildHeatmap(); }
addHabitBtn.onclick=()=>addHabit(newHabit.value); habitAdd.onclick=()=>{ addHabit(habitInput.value); habitInput.value=''; };

// ====== Timer ======
const timerDisplay = document.getElementById('timerDisplay');
const startBtn = document.getElementById('startBtn');
const stopBtn = document.getElementById('stopBtn');
const resetBtn = document.getElementById('resetBtn');
const autoSave = document.getElementById('autoSave');
let running=false, startTs=null, raf=null, lastTs=null;
function loop(ts){ if(!running) return; if(lastTs!=null){ timerDisplay.textContent = fmtMs((ts - lastTs) + (new Date()-startTs)); } lastTs=ts; raf=requestAnimationFrame(loop); }
startBtn.onclick=()=>{ if(running) return; running=true; startTs=new Date(); lastTs=null; stopBtn.disabled=false; resetBtn.disabled=false; startBtn.disabled=true; raf=requestAnimationFrame(loop); };
stopBtn.onclick=()=>{ if(!running) return; running=false; cancelAnimationFrame(raf); const end=new Date(); const mins=minutesBetween(startTs,end); if(autoSave.checked){ const u=current(); u.sessions.push({ habit:habitSelect.value, start:startTs.toISOString(), end:end.toISOString(), minutes:mins }); save(); renderSessions(); refreshKPIs(); rebuildCharts(); buildHeatmap(); buildLeaderboard(); } startBtn.disabled=false; stopBtn.disabled=true; };
resetBtn.onclick=()=>{ running=false; cancelAnimationFrame(raf); timerDisplay.textContent='00:00:00'; startBtn.disabled=false; stopBtn.disabled=true; resetBtn.disabled=true; };

// ====== Sessions Table ======
const sessionRows = document.getElementById('sessionRows');
function renderSessions(){
  const u=current(); sessionRows.innerHTML='';
  [...u.sessions].slice(-50).reverse().forEach((s,i)=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${s.habit}</td><td>${new Date(s.start).toLocaleString()}</td><td>${new Date(s.end).toLocaleString()}</td><td>${fmtMin(s.minutes)}</td><td><button class='danger' data-del='${u.sessions.length-1-i}'>Delete</button></td>`;
    sessionRows.appendChild(tr);
  });
  sessionRows.querySelectorAll('[data-del]').forEach(b=>b.onclick=()=>{ const u=current(); u.sessions.splice(+b.dataset.del,1); save(); renderSessions(); refreshKPIs(); rebuildCharts(); buildHeatmap(); buildLeaderboard(); });
}

// ====== KPIs (Dashboard + Timer box) ======
const D = { today:document.getElementById('d-today'), week:document.getElementById('d-week'), year:document.getElementById('d-year'), life:document.getElementById('d-life'), todayDelta:document.getElementById('d-today-delta') };
const T = { today:document.getElementById('t-today'), week:document.getElementById('t-week'), year:document.getElementById('t-year'), life:document.getElementById('t-life') };
function refreshKPIs(){
  const u=current(); const now=new Date(); const todayKey=dateKey(now); const ydayKey=dateKey(new Date(now.getFullYear(), now.getMonth(), now.getDate()-1)); const weekStart=new Date(now); weekStart.setDate(now.getDate()-6); const yearStart=new Date(now.getFullYear(),0,1);
  const today=sumMins(u, s=>dateKey(s.end)===todayKey); const yday=sumMins(u, s=>dateKey(s.end)===ydayKey); const week=sumMins(u, s=>new Date(s.end)>=weekStart); const year=sumMins(u, s=>new Date(s.end)>=yearStart); const life=sumMins(u, ()=>true);
  D.today.textContent = `${today}m`; D.week.textContent = fmtMin(week); D.year.textContent = fmtMin(year); D.life.textContent = fmtMin(life); T.today.textContent = `${today}m`; T.week.textContent = fmtMin(week); T.year.textContent = fmtMin(year); T.life.textContent = fmtMin(life);
  const delta = yday===0? (today>0? '+100% vs yesterday':'‚Äî vs yesterday') : `${((today-yday)/yday*100).toFixed(0)}% vs yesterday`; D.todayDelta.textContent = delta;
}

// ====== Charts ======
let c1,c2,c3,c4;
function groupByHabitLastNDays(u,n){ const cutoff=new Date(); cutoff.setDate(cutoff.getDate()-n+1); const map={}; u.sessions.filter(s=>new Date(s.end)>=cutoff).forEach(s=>{ map[s.habit]=(map[s.habit]||0)+s.minutes; }); return map; }
function seriesDaily(u,n){ const today=new Date(); const labels=[], values=[]; for(let i=n-1;i>=0;i--){ const d=new Date(today); d.setDate(today.getDate()-i); const k=dateKey(d); labels.push(k.slice(5)); values.push(sumMins(u, s=>dateKey(s.end)===k)); } return {labels,values}; }
function getWeekNumber(d){ d=new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate())); const dayNum=d.getUTCDay()||7; d.setUTCDate(d.getUTCDate()+4-dayNum); const yearStart=new Date(Date.UTC(d.getUTCFullYear(),0,1)); return Math.ceil((((d-yearStart)/86400000)+1)/7); }
function seriesWeekly(u,n){ const today=new Date(); const labels=[], values=[]; for(let i=n-1;i>=0;i--){ const end=new Date(today); end.setDate(end.getDate()-7*(i)); const start=new Date(end); start.setDate(end.getDate()-6); labels.push('W'+getWeekNumber(end)); values.push(sumMins(u, s=>new Date(s.end)>=start && new Date(s.end)<=end)); } return {labels,values}; }
function seriesMonthly(u,n){ const now=new Date(); const labels=[], values=[]; for(let i=n-1;i>=0;i--){ const d=new Date(now.getFullYear(), now.getMonth()-i, 1); const label=d.toLocaleString(undefined,{month:'short'}); labels.push(label); const next=new Date(d.getFullYear(), d.getMonth()+1,1); values.push(sumMins(u, s=>new Date(s.end)>=d && new Date(s.end)<next)); } return {labels,values}; }

function rebuildCharts(){
  const u=current();
  const map=groupByHabitLastNDays(u,14); const labels1=Object.keys(map), vals1=Object.values(map);
  if(c1) c1.destroy(); c1=new Chart(document.getElementById('c-byhabit').getContext('2d'), { type:'bar', data:{labels:labels1, datasets:[{label:'Minutes', data:vals1}]}, options:{plugins:{legend:{display:false}}, responsive:true} });
  const d=seriesDaily(u,14); if(c2) c2.destroy(); c2=new Chart(document.getElementById('c-daily').getContext('2d'), { type:'line', data:{labels:d.labels, datasets:[{label:'Minutes', data:d.values, tension:.3}]}, options:{responsive:true} });
  const w=seriesWeekly(u,12); if(c3) c3.destroy(); c3=new Chart(document.getElementById('c-weekly').getContext('2d'), { type:'bar', data:{labels:w.labels, datasets:[{label:'Minutes', data:w.values}]}, options:{plugins:{legend:{display:false}}, responsive:true} });
  const m=seriesMonthly(u,12); if(c4) c4.destroy(); c4=new Chart(document.getElementById('c-monthly').getContext('2d'), { type:'bar', data:{labels:m.labels, datasets:[{label:'Minutes', data:m.values}]}, options:{plugins:{legend:{display:false}}, responsive:true} });
}

// ====== Heatmap ======
const heatmapEl = document.getElementById('heatmap');
function buildHeatmap(){
  const u=current(); const cells=[]; const today=new Date();
  for(let i=364;i>=0;i--){ const d=new Date(today); d.setDate(today.getDate()-i); const k=dateKey(d); const mins=sumMins(u, s=>dateKey(s.end)===k); const lvl = mins===0?0: mins<15?1: mins<45?2: mins<90?3:4; cells.push(`<div class="cell s${lvl}" title="${k}: ${mins}m"></div>`); }
  heatmapEl.innerHTML = cells.join('');
}

// ====== Leaderboard (All Users) ======
const leaderRows = document.getElementById('leaderRows');
function buildLeaderboard(){
  const rows = Object.entries(data.users).map(([name,u])=>({ name, mins: u.sessions.reduce((a,b)=>a+b.minutes,0) })).sort((a,b)=>b.mins-a.mins);
  leaderRows.innerHTML = rows.map((r,i)=>`<tr><td>${i+1}</td><td>${r.name}</td><td>${r.mins}</td></tr>`).join('');
}

</script>
</body>
</html>


